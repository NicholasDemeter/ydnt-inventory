<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YDNT Item</title>
<link rel="stylesheet" href="style.css"/>
</head><body>
<div class="header wrap"><a href="index.html">← Back</a></div>
<div class="wrap details">
  <div id="media"></div>
  <div id="info"></div>
</div>
<script>
function parseCSV(text){
  const rows=[]; let row=[], field=''; let inQuotes=false; let i=0;
  while(i<text.length){
    const c=text[i];
    if(c==='"'){
      if(inQuotes && text[i+1]==='"'){ field+='"'; i+=2; continue; }
      inQuotes=!inQuotes; i++; continue;
    }
    if(!inQuotes && (c===',')){ row.push(field); field=''; i++; continue; }
    if(!inQuotes && (c=='\n' || c=='\r')){
      if(c=='\r' && text[i+1]=='\n') i++;
      row.push(field); rows.push(row); row=[]; field=''; i++; continue;
    }
    field+=c; i++;
  }
  if(field.length>0 || row.length>0){ row.push(field); rows.push(row); }
  if(rows.length===0) return [];
  const headers = rows[0].map(h=>h.trim());
  return rows.slice(1).filter(r=>r.some(x=>String(x||'').trim().length)).map(r=>{
    const o={}; headers.forEach((h,idx)=>o[h]=r[idx]!==undefined?r[idx]:''); return o;
  });
}
function pick(v,...alts){ for(const k of [v,...alts]){ if(k!==undefined&&k!==null&&String(k).trim()!=='') return String(k).trim(); } return ''; }
function enc(p){ return encodeURI(p); }
async function readCSV(path){ const r=await fetch(path); if(!r.ok) throw new Error('CSV '+r.status); const t=await r.text(); return parseCSV(t); }
function img(src){ const i=new Image(); i.className='thumb'; let u=false; i.onerror=()=>{ if(!u){u=true;i.src=i.src.replace(/thumb\.jpg$/,'thumb.JPG')} else { i.replaceWith(document.createTextNode('asset missing')); } }; i.src=src; return i;}
function q(k){ return new URLSearchParams(location.search).get(k)||''; }
(async()=>{
  const lot=q('lot'); const rows=await readCSV('data/products.csv');
  const row=rows.find(r=>pick(r.LOT,r.lot)==lot);
  const media=document.getElementById('media'); const info=document.getElementById('info');
  if(!row){ info.textContent='Not found'; return; }
  const folder=pick(row.FOLDER_NAME,row.folder_name,row.folderName);
  media.append(img(enc(`/${folder}/Photos/thumb.jpg`)));
  const name=pick(row.OFFICIAL_NAME,row.Name,row.name, lot||folder||'');
  const desc=pick(row.DESCRIPTION,row.description,'');
  const price=pick(row.PRICE,row.price,'');
  info.innerHTML = `<h2>${name}</h2><div class="sub">${lot}${price?` · ${price}`:''}</div><p>${desc}</p>`;
})();
</script>
</body></html>